<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Sharemouz</title>
    <meta name="_csrf" th:attr="content=${_csrf.token}" />
    <!-- default header name is X-CSRF-TOKEN -->
    <meta name="_csrf_header" th:attr="content=${_csrf.headerName}"/>
</head>
<body>

<script type="text/javascript" th:inline="javascript">/*<![CDATA[*/
    var signinCallback = function(authResult) {

        if (authResult['access_token']) {
            console.log('Authentification success');

            var token = document.getElementsByTagName('meta')._csrf.content;
            var header = document.getElementsByTagName('meta')._csrf_header.content;

            var openIdIdentity = authResult.client_id;
            var accessToken = authResult.access_token;
            var idToken = authResult.id_token;

            var req =new XMLHttpRequest();
            req.onreadystatechange=function() {
                if (req.readyState == 4 && req.status == 200) {
                    console.log(req.responseText);
                }
            }
            //req.open('POST','authenticate?openid_identifier=' + openIdentifier + '&openid.identity=' + openIdIdentity + '&access.token=' + accessToken + '&id.token=' + idToken,true);
            req.open('POST','authenticate?&openid.identity=' + openIdIdentity + '&access.token=' + accessToken + '&id.token=' + idToken,true);
            req.setRequestHeader(header, token);
            req.send({

            }); 


        } else if (authResult['error']) {
            console.log('An error occured : ' + authResult['error']);
        }
    }



/*]]>*/	</script>

<form action="authenticate" method="post">
    <input name="openid_identifier" type="hidden" value="https://www.google.com/accounts/o8/id"/>
    <input name="_csrf" type="hidden" th:value="${_csrf.token}"/>
    <input type="submit" value="Sign with Google"/>

</form>
<!--
<span id="signinButton">
  <span
          class="g-signin"
          data-callback="signinCallback"
          data-clientid="356794341635-rcrbalk6m6ubq45ij6885ql80fssf37r.apps.googleusercontent.com"
          data-cookiepolicy="single_host_origin"
          data-requestvisibleactions="http://schemas.google.com/AddActivity"
          data-scope="https://www.googleapis.com/auth/plus.login">
  </span>
</span>
-->
<!-- Placez ce script JavaScript asynchrone juste devant votre balise </body> -->
<script type="text/javascript">
    (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/client:plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
</script>
</body>
</html>